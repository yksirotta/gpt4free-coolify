<!DOCTYPE html>
<html lang="en" data-color-mode="auto" data-light-theme="light" data-dark-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G4F - File API Documentation with Web Download and Enhanced File Support</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/dist/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/dist/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/dist/img/favicon-16x16.png">
    <link rel="manifest" href="/dist/img/site.webmanifest">
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/light-74231a1f3bbb.css" />
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/dark-8a995f0bacd4.css" />
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/primer-primitives-225433424a87.css" />
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/primer-b8b91660c29d.css" />
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/global-205098e9fedd.css" />
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/code-177d21388df8.css" />
    <style>
        :root {
            --colour-1: #000000;
            --colour-2: #ccc;
            --colour-3: #e4d4ff;
            --colour-4: #f0f0f0;
            --colour-5: #181818;
            --colour-6: #242424;
            --accent: #8b3dff;
            --gradient: #1a1a1a;
            --background: #16101b;
            --size: 70vw;
            --top: 50%;
            --blur: 40px;
            --opacity: 0.6;
        }

        /* Body and text color */
        body {
            height: 100vh;
            margin: 0;
            padding: 0;
        }

        .hidden {
            display: none;
        }

        .container-lg {
            margin: 0 auto;
            padding: 8px;
        }

        @media only screen and (min-width: 40em) {
            .container-lg {
                max-width: 84%;
            }
        }
    </style>
</head>
<body>
    <article class="markdown-body entry-content container-lg" itemprop="text"><h2>G4F - File API Documentation with Web Download and Enhanced File Support</h2>
<p>This document details the enhanced G4F File API, allowing users to upload files, download files from web URLs, and process a wider range of file types for integration with language models.</p>
<p><strong>Key Improvements:</strong></p>
<ul>
<li>
<p><strong>Web URL Downloads:</strong>  Upload a <code class="notranslate">downloads.json</code> file to your bucket containing a list of URLs. The API will download and process these files.  Example: <code class="notranslate">[{"url": "https://example.com/document.pdf"}]</code></p>
</li>
<li>
<p><strong>Expanded File Support:</strong>  Added support for additional plain text file extensions:  <code class="notranslate">.txt</code>, <code class="notranslate">.xml</code>, <code class="notranslate">.json</code>, <code class="notranslate">.js</code>, <code class="notranslate">.har</code>, <code class="notranslate">.sh</code>, <code class="notranslate">.py</code>, <code class="notranslate">.php</code>, <code class="notranslate">.css</code>, <code class="notranslate">.yaml</code>, <code class="notranslate">.sql</code>, <code class="notranslate">.log</code>, <code class="notranslate">.csv</code>, <code class="notranslate">.twig</code>, <code class="notranslate">.md</code>.  Binary file support remains for <code class="notranslate">.pdf</code>, <code class="notranslate">.html</code>, <code class="notranslate">.docx</code>, <code class="notranslate">.odt</code>, <code class="notranslate">.epub</code>, <code class="notranslate">.xlsx</code>, and <code class="notranslate">.zip</code>.</p>
</li>
<li>
<p><strong>Server-Sent Events (SSE):</strong>  SSE are now used to provide asynchronous updates on file download and processing progress. This improves the user experience, particularly for large files and multiple downloads.</p>
</li>
</ul>
<p><strong>API Endpoints:</strong></p>
<ul>
<li>
<p><strong>Upload:</strong> <code class="notranslate">/backend-api/v2/files/{bucket_id}</code> (POST)</p>
<ul>
<li><strong>Method:</strong> POST</li>
<li><strong>Path Parameters:</strong> <code class="notranslate">bucket_id</code> (Generated by your own. For example a UUID)</li>
<li><strong>Body:</strong> Multipart/form-data with files OR a <code class="notranslate">downloads.json</code> file containing URLs.</li>
<li><strong>Response:</strong> JSON object with <code class="notranslate">bucket_id</code>, <code class="notranslate">url</code>, and a list of uploaded/downloaded filenames.</li>
</ul>
</li>
<li>
<p><strong>Retrieve:</strong> <code class="notranslate">/backend-api/v2/files/{bucket_id}</code> (GET)</p>
<ul>
<li><strong>Method:</strong> GET</li>
<li><strong>Path Parameters:</strong> <code class="notranslate">bucket_id</code></li>
<li><strong>Query Parameters:</strong>
<ul>
<li><code class="notranslate">delete_files</code>: (Optional, boolean, default <code class="notranslate">true</code>) Delete files after retrieval.</li>
<li><code class="notranslate">refine_chunks_with_spacy</code>: (Optional, boolean, default <code class="notranslate">false</code>) Apply spaCy-based refinement.</li>
</ul>
</li>
<li><strong>Response:</strong> Streaming response with extracted text, separated by ``` markers.  SSE updates are sent if the <code class="notranslate">Accept</code> header includes `text/event-stream`.</li>
</ul>
</li>
</ul>
<p><strong>Example Usage (Python):</strong></p>
<div class="highlight highlight-source-python"><pre class="notranslate"><span class="pl-k">import</span> <span class="pl-s1">requests</span>
<span class="pl-k">import</span> <span class="pl-s1">uuid</span>
<span class="pl-k">import</span> <span class="pl-s1">json</span>

<span class="pl-k">def</span> <span class="pl-en">upload_and_process</span>(<span class="pl-s1">files_or_urls</span>, <span class="pl-s1">bucket_id</span><span class="pl-c1">=</span><span class="pl-c1">None</span>):
    <span class="pl-k">if</span> <span class="pl-s1">bucket_id</span> <span class="pl-c1">is</span> <span class="pl-c1">None</span>:
        <span class="pl-s1">bucket_id</span> <span class="pl-c1">=</span> <span class="pl-en">str</span>(<span class="pl-s1">uuid</span>.<span class="pl-c1">uuid4</span>())
    
    <span class="pl-k">if</span> <span class="pl-en">isinstance</span>(<span class="pl-s1">files_or_urls</span>, <span class="pl-s1">list</span>): <span class="pl-c">#URLs</span>
        <span class="pl-s1">files</span> <span class="pl-c1">=</span> {<span class="pl-s">'files'</span>: (<span class="pl-s">'downloads.json'</span>, <span class="pl-s1">json</span>.<span class="pl-c1">dumps</span>(<span class="pl-s1">files_or_urls</span>), <span class="pl-s">'application/json'</span>)}
    <span class="pl-k">elif</span> <span class="pl-en">isinstance</span>(<span class="pl-s1">files_or_urls</span>, <span class="pl-s1">dict</span>): <span class="pl-c">#Files</span>
        <span class="pl-s1">files</span> <span class="pl-c1">=</span> <span class="pl-s1">files_or_urls</span>
    <span class="pl-k">else</span>:
        <span class="pl-k">raise</span> <span class="pl-en">ValueError</span>(<span class="pl-s">"files_or_urls must be a list of URLs or a dictionary of files"</span>)

    <span class="pl-s1">upload_response</span> <span class="pl-c1">=</span> <span class="pl-s1">requests</span>.<span class="pl-c1">post</span>(<span class="pl-s">f'http://localhost:8080/backend-api/v2/files/<span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">bucket_id</span><span class="pl-kos">}</span></span>'</span>, <span class="pl-s1">files</span><span class="pl-c1">=</span><span class="pl-s1">files</span>)

    <span class="pl-k">if</span> <span class="pl-s1">upload_response</span>.<span class="pl-c1">status_code</span> <span class="pl-c1">==</span> <span class="pl-c1">200</span>:
        <span class="pl-s1">upload_data</span> <span class="pl-c1">=</span> <span class="pl-s1">upload_response</span>.<span class="pl-c1">json</span>()
        <span class="pl-en">print</span>(<span class="pl-s">f"Upload successful. Bucket ID: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">upload_data</span>[<span class="pl-s">'bucket_id'</span>]<span class="pl-kos">}</span></span>"</span>)
    <span class="pl-k">else</span>:
        <span class="pl-en">print</span>(<span class="pl-s">f"Upload failed: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">upload_response</span>.<span class="pl-c1">status_code</span><span class="pl-kos">}</span></span> - <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">upload_response</span>.<span class="pl-c1">text</span><span class="pl-kos">}</span></span>"</span>)

    <span class="pl-s1">response</span> <span class="pl-c1">=</span> <span class="pl-s1">requests</span>.<span class="pl-c1">get</span>(<span class="pl-s">f'http://localhost:8080/backend-api/v2/files/<span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">bucket_id</span><span class="pl-kos">}</span></span>'</span>, <span class="pl-s1">stream</span><span class="pl-c1">=</span><span class="pl-c1">True</span>, <span class="pl-s1">headers</span><span class="pl-c1">=</span>{<span class="pl-s">'Accept'</span>: <span class="pl-s">'text/event-stream'</span>})
    <span class="pl-k">for</span> <span class="pl-s1">line</span> <span class="pl-c1">in</span> <span class="pl-s1">response</span>.<span class="pl-c1">iter_lines</span>():
      <span class="pl-k">if</span> <span class="pl-s1">line</span>:
          <span class="pl-s1">line</span> <span class="pl-c1">=</span> <span class="pl-s1">line</span>.<span class="pl-c1">decode</span>(<span class="pl-s">'utf-8'</span>)
          <span class="pl-k">if</span> <span class="pl-s1">line</span>.<span class="pl-c1">startswith</span>(<span class="pl-s">'data:'</span>):
              <span class="pl-k">try</span>:
                  <span class="pl-s1">data</span> <span class="pl-c1">=</span> <span class="pl-s1">json</span>.<span class="pl-c1">loads</span>(<span class="pl-s1">line</span>[<span class="pl-c1">5</span>:]) <span class="pl-c">#remove data: prefix</span>
                  <span class="pl-k">if</span> <span class="pl-s">"action"</span> <span class="pl-c1">in</span> <span class="pl-s1">data</span>:
                      <span class="pl-en">print</span>(<span class="pl-s">f"SSE Event: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">data</span><span class="pl-kos">}</span></span>"</span>)
                  <span class="pl-k">elif</span> <span class="pl-s">"error"</span> <span class="pl-c1">in</span> <span class="pl-s1">data</span>:
                      <span class="pl-en">print</span>(<span class="pl-s">f"Error: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">data</span>[<span class="pl-s">'error'</span>][<span class="pl-s">'message'</span>]<span class="pl-kos">}</span></span>"</span>)
                  <span class="pl-k">else</span>:
                      <span class="pl-en">print</span>(<span class="pl-s">f"File data received: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">data</span><span class="pl-kos">}</span></span>"</span>) <span class="pl-c">#Assuming it's file content</span>
              <span class="pl-k">except</span> <span class="pl-s1">json</span>.<span class="pl-c1">JSONDecodeError</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
                  <span class="pl-en">print</span>(<span class="pl-s">f"Error decoding JSON: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">e</span><span class="pl-kos">}</span></span>"</span>)
          <span class="pl-k">else</span>:
              <span class="pl-en">print</span>(<span class="pl-s">f"Unhandled SSE event: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">line</span><span class="pl-kos">}</span></span>"</span>)
    <span class="pl-s1">response</span>.<span class="pl-c1">close</span>()
    <span class="pl-k">return</span> <span class="pl-s1">bucket_id</span>

<span class="pl-c"># Example with URLs</span>
<span class="pl-s1">urls</span> <span class="pl-c1">=</span> [{<span class="pl-s">"url"</span>: <span class="pl-s">"https://github.com/xtekky/gpt4free/issues"</span>}]
<span class="pl-s1">bucket_id</span> <span class="pl-c1">=</span> <span class="pl-en">upload_and_process</span>(<span class="pl-s1">urls</span>)

<span class="pl-c">#Example with files</span>
<span class="pl-s1">files</span> <span class="pl-c1">=</span> {<span class="pl-s">'files'</span>: (<span class="pl-s">'document.pdf'</span>, <span class="pl-en">open</span>(<span class="pl-s">'document.pdf'</span>, <span class="pl-s">'rb'</span>))}
<span class="pl-s1">bucket_id</span> <span class="pl-c1">=</span> <span class="pl-en">upload_and_process</span>(<span class="pl-s1">files</span>)</pre></div>
<p><strong>Usage of Uploaded Files:</strong></p>
<div class="highlight highlight-source-python"><pre class="notranslate"><span class="pl-k">from</span> <span class="pl-s1">g4f</span>.<span class="pl-s1">client</span> <span class="pl-k">import</span> <span class="pl-v">Client</span>

<span class="pl-c"># Enable debug mode</span>
<span class="pl-k">import</span> <span class="pl-s1">g4f</span>.<span class="pl-s1">debug</span>
<span class="pl-s1">g4f</span>.<span class="pl-c1">debug</span>.<span class="pl-c1">logging</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>

<span class="pl-s1">client</span> <span class="pl-c1">=</span> <span class="pl-en">Client</span>()

<span class="pl-c"># Upload example file</span>
<span class="pl-s1">files</span> <span class="pl-c1">=</span> {<span class="pl-s">'files'</span>: (<span class="pl-s">'demo.docx'</span>, <span class="pl-en">open</span>(<span class="pl-s">'demo.docx'</span>, <span class="pl-s">'rb'</span>))}
<span class="pl-s1">bucket_id</span> <span class="pl-c1">=</span> <span class="pl-en">upload_and_process</span>(<span class="pl-s1">files</span>)

<span class="pl-c"># Send request with file:</span>
<span class="pl-s1">response</span> <span class="pl-c1">=</span> <span class="pl-s1">client</span>.<span class="pl-c1">chat</span>.<span class="pl-c1">completions</span>.<span class="pl-c1">create</span>(
    [{<span class="pl-s">"role"</span>: <span class="pl-s">"user"</span>, <span class="pl-s">"content"</span>: [
        {<span class="pl-s">"type"</span>: <span class="pl-s">"text"</span>, <span class="pl-s">"text"</span>: <span class="pl-s">"Discribe this file."</span>},
        {<span class="pl-s">"bucket_id"</span>: <span class="pl-s1">bucket_id</span>}
    ]}],
)
<span class="pl-en">print</span>(<span class="pl-s1">response</span>.<span class="pl-c1">choices</span>[<span class="pl-c1">0</span>].<span class="pl-c1">message</span>.<span class="pl-c1">content</span>)</pre></div>
<p><strong>Example Output:</strong></p>
<pre class="notranslate"><code class="notranslate">This document is a demonstration of the DOCX Input plugin capabilities in the software ...
</code></pre>
<p><strong>Example Usage (JavaScript):</strong></p>
<div class="highlight highlight-source-js"><pre class="notranslate"><span class="pl-k">function</span> <span class="pl-en">uuid</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
    <span class="pl-k">return</span> <span class="pl-kos">(</span><span class="pl-kos">[</span><span class="pl-c1">1e7</span><span class="pl-kos">]</span><span class="pl-c1">+</span><span class="pl-c1">-</span><span class="pl-c1">1e3</span><span class="pl-c1">+</span><span class="pl-c1">-</span><span class="pl-c1">4e3</span><span class="pl-c1">+</span><span class="pl-c1">-</span><span class="pl-c1">8e3</span><span class="pl-c1">+</span><span class="pl-c1">-</span><span class="pl-c1">1e11</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">replace</span><span class="pl-kos">(</span><span class="pl-pds"><span class="pl-c1">/</span><span class="pl-kos">[</span><span class="pl-c1">0</span><span class="pl-c1">1</span><span class="pl-c1">8</span><span class="pl-kos">]</span><span class="pl-c1">/</span>g</span><span class="pl-kos">,</span> <span class="pl-s1">c</span> <span class="pl-c1">=&gt;</span>
      <span class="pl-kos">(</span><span class="pl-s1">c</span> <span class="pl-c1">^</span> <span class="pl-s1">crypto</span><span class="pl-kos">.</span><span class="pl-en">getRandomValues</span><span class="pl-kos">(</span><span class="pl-k">new</span> <span class="pl-v">Uint8Array</span><span class="pl-kos">(</span><span class="pl-c1">1</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">[</span><span class="pl-c1">0</span><span class="pl-kos">]</span> <span class="pl-c1">&amp;</span> <span class="pl-c1">15</span> <span class="pl-c1">&gt;&gt;</span> <span class="pl-s1">c</span> <span class="pl-c1">/</span> <span class="pl-c1">4</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">toString</span><span class="pl-kos">(</span><span class="pl-c1">16</span><span class="pl-kos">)</span>
    <span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">upload_files_or_urls</span><span class="pl-kos">(</span><span class="pl-s1">data</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
    <span class="pl-k">let</span> <span class="pl-s1">bucket_id</span> <span class="pl-c1">=</span> <span class="pl-en">uuid</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span> <span class="pl-c">// Use a random generated key for your bucket</span>

    <span class="pl-k">let</span> <span class="pl-s1">formData</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-v">FormData</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-k">typeof</span> <span class="pl-s1">data</span> <span class="pl-c1">===</span> <span class="pl-s">"object"</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-s1">data</span><span class="pl-kos">.</span><span class="pl-c1">constructor</span> <span class="pl-c1">===</span> <span class="pl-v">Array</span><span class="pl-kos">)</span> <span class="pl-kos">{</span> <span class="pl-c">//URLs</span>
        <span class="pl-k">const</span> <span class="pl-s1">blob</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-v">Blob</span><span class="pl-kos">(</span><span class="pl-kos">[</span><span class="pl-c1">JSON</span><span class="pl-kos">.</span><span class="pl-en">stringify</span><span class="pl-kos">(</span><span class="pl-s1">data</span><span class="pl-kos">)</span><span class="pl-kos">]</span><span class="pl-kos">,</span> <span class="pl-kos">{</span> <span class="pl-c1">type</span>: <span class="pl-s">'application/json'</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-k">const</span> <span class="pl-s1">file</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-v">File</span><span class="pl-kos">(</span><span class="pl-kos">[</span><span class="pl-s1">blob</span><span class="pl-kos">]</span><span class="pl-kos">,</span> <span class="pl-s">'downloads.json'</span><span class="pl-kos">,</span> <span class="pl-kos">{</span> <span class="pl-c1">type</span>: <span class="pl-s">'application/json'</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span> <span class="pl-c">// Create File object</span>
        <span class="pl-s1">formData</span><span class="pl-kos">.</span><span class="pl-en">append</span><span class="pl-kos">(</span><span class="pl-s">'files'</span><span class="pl-kos">,</span> <span class="pl-s1">file</span><span class="pl-kos">)</span><span class="pl-kos">;</span> <span class="pl-c">// Append as a file</span>
    <span class="pl-kos">}</span> <span class="pl-k">else</span> <span class="pl-kos">{</span> <span class="pl-c">//Files</span>
        <span class="pl-v">Array</span><span class="pl-kos">.</span><span class="pl-en">from</span><span class="pl-kos">(</span><span class="pl-s1">data</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">forEach</span><span class="pl-kos">(</span><span class="pl-s1">file</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
            <span class="pl-s1">formData</span><span class="pl-kos">.</span><span class="pl-en">append</span><span class="pl-kos">(</span><span class="pl-s">'files'</span><span class="pl-kos">,</span> <span class="pl-s1">file</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>

    <span class="pl-k">await</span> <span class="pl-en">fetch</span><span class="pl-kos">(</span><span class="pl-s">"/backend-api/v2/files/"</span> <span class="pl-c1">+</span> <span class="pl-s1">bucket_id</span><span class="pl-kos">,</span> <span class="pl-kos">{</span>
        <span class="pl-c1">method</span>: <span class="pl-s">'POST'</span><span class="pl-kos">,</span>
        <span class="pl-c1">body</span>: <span class="pl-s1">formData</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-k">function</span> <span class="pl-en">connectToSSE</span><span class="pl-kos">(</span><span class="pl-s1">url</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-k">const</span> <span class="pl-s1">eventSource</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-v">EventSource</span><span class="pl-kos">(</span><span class="pl-s1">url</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-s1">eventSource</span><span class="pl-kos">.</span><span class="pl-en">onmessage</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-s1">event</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
            <span class="pl-k">const</span> <span class="pl-s1">data</span> <span class="pl-c1">=</span> <span class="pl-c1">JSON</span><span class="pl-kos">.</span><span class="pl-en">parse</span><span class="pl-kos">(</span><span class="pl-s1">event</span><span class="pl-kos">.</span><span class="pl-c1">data</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
            <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">data</span><span class="pl-kos">.</span><span class="pl-c1">error</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
                <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">error</span><span class="pl-kos">(</span><span class="pl-s">"Error:"</span><span class="pl-kos">,</span> <span class="pl-s1">data</span><span class="pl-kos">.</span><span class="pl-c1">error</span><span class="pl-kos">.</span><span class="pl-c1">message</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
            <span class="pl-kos">}</span> <span class="pl-k">else</span> <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">data</span><span class="pl-kos">.</span><span class="pl-c1">action</span> <span class="pl-c1">===</span> <span class="pl-s">"done"</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
                <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">"Files loaded successfully. Bucket ID:"</span><span class="pl-kos">,</span> <span class="pl-s1">bucket_id</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
                <span class="pl-c">// Use bucket_id in your LLM prompt.</span>
                <span class="pl-k">const</span> <span class="pl-s1">prompt</span> <span class="pl-c1">=</span> <span class="pl-s">`Use files from bucket. <span class="pl-s1"><span class="pl-kos">${</span><span class="pl-c1">JSON</span><span class="pl-kos">.</span><span class="pl-en">stringify</span><span class="pl-kos">(</span><span class="pl-kos">{</span><span class="pl-s">"bucket_id"</span>: <span class="pl-s1">bucket_id</span><span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">}</span></span> to answer this: ...your question...`</span><span class="pl-kos">;</span>
                <span class="pl-c">// ... Send prompt to your language model ...</span>
            <span class="pl-kos">}</span> <span class="pl-k">else</span> <span class="pl-kos">{</span>
                <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">"SSE Event:"</span><span class="pl-kos">,</span> <span class="pl-s1">data</span><span class="pl-kos">)</span><span class="pl-kos">;</span> <span class="pl-c">// Update UI with progress as needed</span>
            <span class="pl-kos">}</span>
        <span class="pl-kos">}</span><span class="pl-kos">;</span>
        <span class="pl-s1">eventSource</span><span class="pl-kos">.</span><span class="pl-en">onerror</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-s1">event</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
            <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">error</span><span class="pl-kos">(</span><span class="pl-s">"SSE Error:"</span><span class="pl-kos">,</span> <span class="pl-s1">event</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
            <span class="pl-s1">eventSource</span><span class="pl-kos">.</span><span class="pl-en">close</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>

    <span class="pl-en">connectToSSE</span><span class="pl-kos">(</span><span class="pl-s">`/backend-api/v2/files/<span class="pl-s1"><span class="pl-kos">${</span><span class="pl-s1">bucket_id</span><span class="pl-kos">}</span></span>`</span><span class="pl-kos">)</span><span class="pl-kos">;</span> <span class="pl-c">//Retrieve and refine</span>
<span class="pl-kos">}</span>

<span class="pl-c">// Example with URLs</span>
<span class="pl-k">const</span> <span class="pl-s1">urls</span> <span class="pl-c1">=</span> <span class="pl-kos">[</span><span class="pl-kos">{</span><span class="pl-s">"url"</span>: <span class="pl-s">"https://github.com/xtekky/gpt4free/issues"</span><span class="pl-kos">}</span><span class="pl-kos">]</span><span class="pl-kos">;</span>
<span class="pl-en">upload_files_or_urls</span><span class="pl-kos">(</span><span class="pl-s1">urls</span><span class="pl-kos">)</span>

<span class="pl-c">// Example with files (using a file input element)</span>
<span class="pl-k">const</span> <span class="pl-s1">fileInput</span> <span class="pl-c1">=</span> <span class="pl-smi">document</span><span class="pl-kos">.</span><span class="pl-en">getElementById</span><span class="pl-kos">(</span><span class="pl-s">'fileInput'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-s1">fileInput</span><span class="pl-kos">.</span><span class="pl-en">addEventListener</span><span class="pl-kos">(</span><span class="pl-s">'change'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
    <span class="pl-en">upload_files_or_urls</span><span class="pl-kos">(</span><span class="pl-s1">fileInput</span><span class="pl-kos">.</span><span class="pl-c1">files</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div>
<p><strong>Integrating with <code class="notranslate">ChatCompletion</code>:</strong></p>
<p>To incorporate file uploads into your client applications, include the <code class="notranslate">bucket</code> in your chat completion requests, using inline content parts.</p>
<div class="highlight highlight-source-json"><pre class="notranslate">{
  <span class="pl-ent">"messages"</span>: [
    {
      <span class="pl-ent">"role"</span>: <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>,
      <span class="pl-ent">"content"</span>: [
        {<span class="pl-ent">"type"</span>: <span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>, <span class="pl-ent">"text"</span>: <span class="pl-s"><span class="pl-pds">"</span>Answer this question using the files in the specified bucket: ...your question...<span class="pl-pds">"</span></span>},
        {<span class="pl-ent">"bucket_id"</span>: <span class="pl-s"><span class="pl-pds">"</span>your_actual_bucket_id<span class="pl-pds">"</span></span>}
      ]
    }
  ]
}</pre></div>
<p><strong>Important Considerations:</strong></p>
<ul>
<li><strong>Error Handling:</strong> Implement robust error handling in both Python and JavaScript to gracefully manage potential issues during file uploads, downloads, and API interactions.</li>
<li><strong>Dependencies:</strong> Ensure all required packages are installed (<code class="notranslate">pip install -U g4f[files]</code> for Python).</li>
</ul>
<hr>
<h2>📄 MarkItDown – Lightweight File-to-Text API (Alternative to G4F File API)</h2>
<p><code class="notranslate">markitdown</code> is a simple and lightweight alternative to the G4F File API for extracting <strong>plain or markdown-formatted text</strong> from uploaded files. While the G4F File API supports bucket-based multi-file workflows and streaming, <code class="notranslate">markitdown</code> is ideal for <strong>quick, direct conversion of individual files</strong> (e.g. <code class="notranslate">.pdf</code>, <code class="notranslate">.docx</code>, <code class="notranslate">.wav</code>, etc.).</p>
<h3>✅ Key Features</h3>
<ul>
<li>🔄 Converts a wide range of files (PDF, DOCX, TXT, AUDIO, etc.) to markdown/plain text.</li>
<li>📤 Simple POST API: Send a file, receive extracted text.</li>
<li>⚡ Fast, no bucket, SSE, or URL fetch needed.</li>
<li>🎯 Ideal for use-cases where full document text is needed inline in chat prompts.</li>
</ul>
<hr>
<h3>📦 Installation</h3>
<div class="highlight highlight-source-shell"><pre class="notranslate">pip install markitdown[all]</pre></div>
<hr>
<h3>🐍 Example Usage (Python)</h3>
<div class="highlight highlight-source-python"><pre class="notranslate"><span class="pl-k">import</span> <span class="pl-s1">requests</span>

<span class="pl-k">def</span> <span class="pl-en">convert_with_markitdown</span>(<span class="pl-s1">file_path</span>):
    <span class="pl-k">with</span> <span class="pl-en">open</span>(<span class="pl-s1">file_path</span>, <span class="pl-s">'rb'</span>) <span class="pl-k">as</span> <span class="pl-s1">file</span>:
        <span class="pl-s1">response</span> <span class="pl-c1">=</span> <span class="pl-s1">requests</span>.<span class="pl-c1">post</span>(<span class="pl-s">'http://localhost:8080/api/markitdown'</span>, <span class="pl-s1">files</span><span class="pl-c1">=</span>{<span class="pl-s">'file'</span>: <span class="pl-s1">file</span>})
        <span class="pl-k">if</span> <span class="pl-s1">response</span>.<span class="pl-c1">status_code</span> <span class="pl-c1">==</span> <span class="pl-c1">200</span>:
            <span class="pl-s1">data</span> <span class="pl-c1">=</span> <span class="pl-s1">response</span>.<span class="pl-c1">json</span>()
            <span class="pl-k">return</span> <span class="pl-s1">data</span>[<span class="pl-s">'text'</span>]
        <span class="pl-k">else</span>:
            <span class="pl-k">raise</span> <span class="pl-en">Exception</span>(<span class="pl-s">f"Conversion failed: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">response</span>.<span class="pl-c1">status_code</span><span class="pl-kos">}</span></span> - <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">response</span>.<span class="pl-c1">text</span><span class="pl-kos">}</span></span>"</span>)

<span class="pl-c"># Usage</span>
<span class="pl-s1">text</span> <span class="pl-c1">=</span> <span class="pl-en">convert_with_markitdown</span>(<span class="pl-s">'example.pdf'</span>)
<span class="pl-en">print</span>(<span class="pl-s1">text</span>)</pre></div>
<hr>
<h3>🌐 Example Usage (JavaScript)</h3>
<div class="highlight highlight-text-html-basic"><pre class="notranslate"><span class="pl-kos">&lt;</span><span class="pl-ent">input</span> <span class="pl-c1">type</span>="<span class="pl-s">file</span>" <span class="pl-c1">id</span>="<span class="pl-s">fileInput</span>" <span class="pl-kos">/&gt;</span>

<span class="pl-kos">&lt;</span><span class="pl-ent">script</span><span class="pl-kos">&gt;</span>
<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">convertToMarkdown</span><span class="pl-kos">(</span><span class="pl-s1">file</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
    <span class="pl-k">const</span> <span class="pl-s1">formData</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-v">FormData</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">formData</span><span class="pl-kos">.</span><span class="pl-en">append</span><span class="pl-kos">(</span><span class="pl-s">'file'</span><span class="pl-kos">,</span> <span class="pl-s1">file</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-k">try</span> <span class="pl-kos">{</span>
        <span class="pl-k">const</span> <span class="pl-s1">response</span> <span class="pl-c1">=</span> <span class="pl-k">await</span> <span class="pl-en">fetch</span><span class="pl-kos">(</span><span class="pl-s">'http://localhost:8080/api/markitdown'</span><span class="pl-kos">,</span> <span class="pl-kos">{</span>
            <span class="pl-c1">method</span>: <span class="pl-s">'POST'</span><span class="pl-kos">,</span>
            <span class="pl-c1">body</span>: <span class="pl-s1">formData</span>
        <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

        <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-s1">response</span><span class="pl-kos">.</span><span class="pl-c1">ok</span><span class="pl-kos">)</span> <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-v">Error</span><span class="pl-kos">(</span><span class="pl-s">`HTTP <span class="pl-s1"><span class="pl-kos">${</span><span class="pl-s1">response</span><span class="pl-kos">.</span><span class="pl-c1">status</span><span class="pl-kos">}</span></span>`</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

        <span class="pl-k">const</span> <span class="pl-s1">data</span> <span class="pl-c1">=</span> <span class="pl-k">await</span> <span class="pl-s1">response</span><span class="pl-kos">.</span><span class="pl-en">json</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">"Converted Text:"</span><span class="pl-kos">,</span> <span class="pl-s1">data</span><span class="pl-kos">.</span><span class="pl-c1">text</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

        <span class="pl-c">// You can now inject data.text into a prompt or display in the UI.</span>
    <span class="pl-kos">}</span> <span class="pl-k">catch</span> <span class="pl-kos">(</span><span class="pl-s1">error</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">error</span><span class="pl-kos">(</span><span class="pl-s">'Conversion failed:'</span><span class="pl-kos">,</span> <span class="pl-s1">error</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span>

<span class="pl-smi">document</span><span class="pl-kos">.</span><span class="pl-en">getElementById</span><span class="pl-kos">(</span><span class="pl-s">'fileInput'</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">addEventListener</span><span class="pl-kos">(</span><span class="pl-s">'change'</span><span class="pl-kos">,</span> <span class="pl-k">async</span> <span class="pl-kos">(</span><span class="pl-s1">e</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
    <span class="pl-k">const</span> <span class="pl-s1">file</span> <span class="pl-c1">=</span> <span class="pl-s1">e</span><span class="pl-kos">.</span><span class="pl-c1">target</span><span class="pl-kos">.</span><span class="pl-c1">files</span><span class="pl-kos">[</span><span class="pl-c1">0</span><span class="pl-kos">]</span><span class="pl-kos">;</span>
    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">file</span><span class="pl-kos">)</span> <span class="pl-k">await</span> <span class="pl-en">convertToMarkdown</span><span class="pl-kos">(</span><span class="pl-s1">file</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">&lt;/</span><span class="pl-ent">script</span><span class="pl-kos">&gt;</span></pre></div>
<hr>
<h3>💬 Integration with ChatCompletion</h3>
<p>Once you retrieve <code class="notranslate">text</code> from <code class="notranslate">markitdown</code>, you can insert it into your LLM prompt as inline content:</p>
<div class="highlight highlight-source-json"><pre class="notranslate">{
  <span class="pl-ent">"messages"</span>: [
    {
      <span class="pl-ent">"role"</span>: <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>,
      <span class="pl-ent">"content"</span>: [
        { <span class="pl-ent">"type"</span>: <span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>, <span class="pl-ent">"text"</span>: <span class="pl-s"><span class="pl-pds">"</span>&lt;text_from_markitdown&gt;<span class="pl-pds">"</span></span> },
        { <span class="pl-ent">"type"</span>: <span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>, <span class="pl-ent">"text"</span>: <span class="pl-s"><span class="pl-pds">"</span>Answer this question using the above content: ...your question...<span class="pl-pds">"</span></span> }
      ]
    }
  ]
}</pre></div>
<p>Example in Python:</p>
<div class="highlight highlight-source-python"><pre class="notranslate"><span class="pl-s1">response</span> <span class="pl-c1">=</span> <span class="pl-s1">client</span>.<span class="pl-c1">chat</span>.<span class="pl-c1">completions</span>.<span class="pl-c1">create</span>(
    <span class="pl-s1">messages</span><span class="pl-c1">=</span>[
        {
            <span class="pl-s">"role"</span>: <span class="pl-s">"user"</span>,
            <span class="pl-s">"content"</span>: [
                {<span class="pl-s">"type"</span>: <span class="pl-s">"text"</span>, <span class="pl-s">"text"</span>: <span class="pl-s1">text</span>},
                {<span class="pl-s">"type"</span>: <span class="pl-s">"text"</span>, <span class="pl-s">"text"</span>: <span class="pl-s">"Summarize this document."</span>}
            ]
        }
    ]
)</pre></div>
<hr>
<h3>🔄 G4F File API vs MarkItDown</h3>
<markdown-accessiblity-table><table role="table">
<thead>
<tr>
<th>Feature</th>
<th>G4F File API</th>
<th>MarkItDown API</th>
</tr>
</thead>
<tbody>
<tr>
<td>Upload Files</td>
<td>✅ Yes</td>
<td>✅ Yes</td>
</tr>
<tr>
<td>Web URL Downloads</td>
<td>✅ Yes via <code class="notranslate">downloads.json</code></td>
<td>❌ No</td>
</tr>
<tr>
<td>SSE Progress Streaming</td>
<td>✅ Yes</td>
<td>❌ No</td>
</tr>
<tr>
<td>Markdown/Text Output</td>
<td>Raw/structured</td>
<td>Clean markdown/plain text</td>
</tr>
<tr>
<td>Bucket/File Management</td>
<td>✅ Multi-file</td>
<td>❌ Single-file only</td>
</tr>
<tr>
<td>Use Case</td>
<td>Multi-step pipelines, large workflows</td>
<td>Quick extraction, inline usage</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<hr>
<h3>📌 Summary</h3>
<ul>
<li>
<p>Use <strong>G4F File API</strong> when:</p>
<ul>
<li>You need to upload/download many files.</li>
<li>You want streamed SSE progress.</li>
<li>You're building a multi-step or large workflow.</li>
</ul>
</li>
<li>
<p>Use <strong>MarkItDown</strong> when:</p>
<ul>
<li>You want quick markdown/plain text extraction from a single file.</li>
<li>You plan to inject the text directly into an LLM prompt.</li>
<li>You prefer a simple one-call API.</li>
</ul>
</li>
</ul>
<hr>
<p><a href="/docs/">Return to Documentation</a></p></article>
</body>
</html>